<!doctype html>
<html>
  <head>
    <title>Enemy Health Bar Test</title>
    <script type="module">
      import { Game } from './public/src/core/game.js';

      window.addEventListener('DOMContentLoaded', async () => {
        console.log('Starting enemy health bar test...');

        const game = new Game();
        window.game = game;

        await game.init();

        // Wait a bit for everything to load
        setTimeout(() => {
          // Start the game automatically
          game.startGame();

          // Wait for enemies to be spawned
          setTimeout(() => {
            console.log('Enemies loaded:', game.enemies.length);

            if (game.enemies.length > 0) {
              const enemy = game.enemies[0];
              const player = game.player;

              console.log('Initial enemy HP:', enemy.hp, '/', enemy.maxHp);
              console.log(
                'Initial distance:',
                player.mesh.position.distanceTo(enemy.mesh.position)
              );

              // Move player close to enemy
              const enemyPos = enemy.mesh.position;
              player.mesh.position.set(
                enemyPos.x + 3,
                enemyPos.y,
                enemyPos.z + 3
              );

              console.log(
                'Moved player close. New distance:',
                player.mesh.position.distanceTo(enemy.mesh.position)
              );

              // Check health bars after 1 second
              setTimeout(() => {
                const healthBars =
                  document.querySelectorAll('.enemy-health-bar');
                console.log('Health bars found:', healthBars.length);

                if (healthBars.length > 0) {
                  console.log(
                    'Health bar visible:',
                    healthBars[0].style.display !== 'none'
                  );

                  // Damage the enemy to test health bar update
                  enemy.takeDamage(10);
                  console.log(
                    'Enemy HP after damage:',
                    enemy.hp,
                    '/',
                    enemy.maxHp
                  );

                  // Move player far away after 2 seconds
                  setTimeout(() => {
                    player.mesh.position.set(50, 0, 50);
                    console.log(
                      'Moved player far. New distance:',
                      player.mesh.position.distanceTo(enemy.mesh.position)
                    );

                    setTimeout(() => {
                      const healthBarsAfter =
                        document.querySelectorAll('.enemy-health-bar');
                      if (healthBarsAfter.length > 0) {
                        console.log(
                          'Health bar hidden:',
                          healthBarsAfter[0].style.display === 'none'
                        );
                      }
                    }, 100);
                  }, 2000);
                }
              }, 1000);
            } else {
              console.log('No enemies found!');
            }
          }, 2000);
        }, 5000);
      });
    </script>
  </head>
  <body>
    <h1>Enemy Health Bar Test</h1>
    <p>Open browser console to see test results.</p>
    <p>Health bars should appear above enemies when you get close to them.</p>
  </body>
</html>
